# Архитектурное решение v2: Проект "Контентная воронка"

## 1. Философия и цели

- **Централизация контента:** Создание "фабрики" астрологического и эзотерического контента.
- **Удобство потребления:** Бесплатный, удобный поиск, навигация и углубление в материалы.
- **Вовлечение:** Захват внимания пользователей через геймификацию, поощрения и виртуальную валюту.
- **Стратегическая цель:** Создание лояльной аудитории для будущих проектов, таких как "Астрофест".

## 2. Общая архитектура системы

Система будет построена на микросервисной архитектуре, чтобы обеспечить гибкость, масштабируемость и независимую разработку компонентов.

```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   Telegram      │    │   API Gateway    │    │   Платформа XL  │
│   Mini App      │◄──►│   (Kong/Nginx)   │◄──►│   (Веб-портал)  │
│   (React/Vue)   │    │                  │    │                 │
└─────────────────┘    └──────────────────┘    └─────────────────┘
                             │
                             ▼
     ┌─────────────────────────────────────────────────────────┐
     │                    Микросервисы (Node.js/Python)        │
     │ ┌─────────────┐  ┌─────────────┐ ┌─────────────────┐  │
     │  │  User       │  │  Content    │  │  Gamification   │  │
     │  │  Service    │  │  Service    │  │  Service        │  │
     │  └─────────────┘  └─────────────┘  └─────────────────┘  │
     │         │               │                   │           │
     │         ▼               ▼                   ▼           │
     │  ┌─────────────┐  ┌─────────────┐  ┌─────────────────┐  │
     │  │  Search     │  │  Agents     │  │  Notification   │  │
     │  │  Service    │  │  Service    │  │  Service        │  │
     │  └─────────────┘  └─────────────┘  └─────────────────┘  │
     └─────────────────────────────────────────────────┘
                             │
                             ▼
     ┌─────────────────────────────────────────────────┐
     │                    Базы данных                          │
     │ ┌─────────────┐  ┌─────────────┐ ┌─────────────────┐  │
     │  │ PostgreSQL  │  │ Elasticsearch│  │     Redis       │  │
     │  │ (основные   │  │ (поиск)      │  │   (кеш/очереди) │  │
     │  │ данные)     │  │              │  │                 │  │
     └─────────────────────────────────────────────────┘
```

## 3. Компоненты архитектуры

### 3.1. Frontend (Telegram Mini App)

- **Технологии:** React/Vue.js с TypeScript, Redux/Zustand для стейт-менеджмента, Tailwind CSS.
- **Интеграция:** Полная поддержка Telegram Web App API для нативного вида и аутентификации.
- **Ключевые экраны:**
    - **Главная:** Лента персонализированного контента.
    - **Галерея экспертов:** Профили "звезд" проекта с фото, описанием и контактами.
    - **Поиск:** Мощный поиск по темам, ключевым словам и экспертам.
    - **Профиль пользователя:** Статистика, награды, виртуальная валюта.
    - **Сервисы:** Доступ к астрологическим программам и ассистентам.

### 3.2. API Gateway

- **Технологии:** Kong или Nginx.
- **Задачи:** Маршрутизация запросов, аутентификация (JWT), логирование, защита от DDoS.

### 3.3. Микросервисы

- **Языки:** Node.js (TypeScript) или Python (FastAPI).
- **Контейнеризация:** Docker.
- **Сервисы:**
    - **User Service:** Управление пользователями, их данными и профилями.
    - **Content Service:** Управление контентом, включая "машину перемалывания" (транскрибация, нарезка, категоризация). Интеграция с ИИ для обработки.
    - **Gamification Service:** Управление виртуальной валютой, наградами, достижениями.
    - **Search Service:** Интеграция с Elasticsearch для мощного и релевантного поиска.
    - **Agents Service:** Логика для ассистентов и помощников, помогающих пользователям выбирать материалы.
    - **Notification Service:** Уведомления в Telegram.

### 3.4. Базы данных

- **PostgreSQL:** Основная реляционная база для хранения структурированных данных (пользователи, эксперты, метаданные контента, транзакции).
- **Elasticsearch:** Для реализации мощного полнотекстового поиска.
- **Redis:** Кеширование, управление сессиями и очереди задач.

## 4. Источники и работа с контентом

- **Источники:** Эфиры, видео с фестивалей, разборы, мастер-группы, курсы, открытые источники.
- **Обработка ("Машина перемалывания"):**
    1.  **Транскрибация:** Видео и аудио переводятся в текст.
    2.  **Сегментация:** Текст разбивается на смысловые блоки.
    3.  **Категоризация:** Контент помечается тегами (темы, эксперты, уровень сложности).
    4.  **Генерация выжимок:** ИИ создает краткое, среднее и полное содержание.
    5.  **Создание форматов:** Генерация аудио-подкастов, коротких видео, статей.
- **Принадлежность:** Весь контент принадлежит экспертам, что должно быть отражено в системе.

## 5. Ключевые функции для реализации

- **Мощный поиск:** Не просто поиск, а система, которая понимает запрос и дает релевантные результаты.
- **Галерея экспертов:** Отдельный, ярко выраженный раздел в приложении.
- **Агенты-помощники:** Чат-боты или ассистенты, которые ведут пользователя по контенту.
- **Сервисы:** Интеграция с внешними или внутренними астрологическими программами.
- **Продукты:** Система должна предусматривать возможность продажи продуктов по подписке или за разовую плату.

## 6. Технологический стек (рекомендации)

- **Backend:** Node.js, NestJS, TypeScript, PostgreSQL, Elasticsearch, Redis, Docker.
- **Frontend:** React, TypeScript, Zustand, Tailwind CSS, Telegram Web App SDK.
- **DevOps:** GitHub Actions, Prometheus, Grafana, Yandex Cloud/AWS.

## 7. Этапы реализации

### Этап 1: MVP (Минимально жизнеспособный продукт)
- Базовая аутентификация через Telegram.
- Ручная загрузка и отображение контента.
- Простейший поиск.
- Базовая система "звездочек".
- Галерея экспертов.

### Этап 2: Автоматизация и геймификация
- Реализация "машины перемалывания контента" с ИИ.
- Продвинутая геймификация с виртуальной валютой.
- Внедрение Elasticsearch для мощного поиска.
- Разработка "агентов-помощников".

### Этап 3: Масштабирование и монетизация
- Интеграция с платформой XL.
- Реализация продажи продуктов и подписок.
- Разработка API для внешних сервисов.
- Оптимизация производительности и масштабирование.