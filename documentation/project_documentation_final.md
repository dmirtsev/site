# Единая документация проекта "АстроТочка" (v7, Архитектура данных)

## 1. Философия и главные идеи

- **Пользователь в центре:** Весь опыт строится вокруг пользователя, его прогресса и достижений.
- **Итеративность:** Разработка короткими циклами «шаг → метрики → следующий шаг».
- **Эксперт-центричность:** "Лица/звёзды" проекта — центральный элемент для привлечения внимания.
- **Экономика внимания:** Вознаграждение пользователей "звездами" за их вовлеченность.
- **Короткие смыслы:** Основа контента — микро-выжимки, карточки и цитаты.
- **Регулярность:** Создание ритма вовлечения через автоматизированные форматы.

## 2. Архитектура данных и сущности

### 2.1. Основные сущности (Таблицы БД)
-   **`users`**: Пользователи (telegram_id, name, level, stars_balance).
-   **`experts`**: **Справочник** экспертов (name, photo, bio).
-   **`tags`**: **Справочник** тем (name).
-   **`content_sources`**: Метаданные исходных материалов (видео/аудио).
-   **`content_items`**: **Основная таблица контента**, где лежат производные продукты (карточки, заметки). Связана с `sources`, `experts`, `tags`.
-   **`funnels`** и **`funnel_steps`**: Конструктор "Воронок Внимания".
-   **`user_progress`**: История взаимодействий пользователя с контентом.

### 2.2. Инструменты управления (Админ-панель)
-   **Рекомендация:** Использовать готовый **Headless CMS** (например, **Strapi** или **Directus**) для создания мощной и удобной админ-панели.
-   **Функционал:**
    1.  **Управление справочниками:** Простое добавление и редактирование экспертов и тегов.
    2.  **Управление контентом:** Загрузка исходников, запуск "контент-машины", редактирование и утверждение производных продуктов.
    3.  **Конструктор воронок:** Визуальное создание последовательностей показа контента.

## 3. Архитектура интерфейса (UI/UX)

-   **Профиль как главный экран:** Пользователь всегда начинает со своего профиля.
-   **Нижнее меню:** **[ Профиль ]** • **[ Лента ]** • **[ Поиск ]** • **[ Эксперты ]** • **[ Курсы ]**.
-   **Контекстное появление контента:** Большинство форматов (заметки, аудио, викторины) появляются внутри других, а не как отдельные разделы.

## 4. Карта контента (что и где показываем)

1.  **T1 (Короткая карточка):** Тизер в Telegram-каналах.
2.  **T2 (Расширенная карточка):** Основной формат в **Ленте**.
3.  **T3 (Заметка):** Доступна по кнопке "Подробнее" из T2.
4.  **T4 (Транскрипт):** Платный доступ на XL по ссылке из T3.
5.  **A1 (Аудио):** Интегрирован как плеер в T2/T3.
6.  **K1-K4 (Клипы):** Блок "сторис" в **Ленте**.
7.  **P1-P4 (Презентации):** Прикреплены к T3.
8.  **V1-V4 (Викторины):** Контекстно, после серии карточек.
9.  **Галерея экспертов:** Раздел в нижнем меню.
10. **Поиск:** Раздел в нижнем меню.
11. **Дайджесты:** Карточка в **Ленте** и рассылка.
12. **Курсы/Сервисы:** Раздел в нижнем меню.
13. **Агенты ("Служба заботы", "МИРА"):** Виджеты в хедере.

## 5. Технологический стек

- **Frontend:** React.js с Vite и TypeScript.
- **Backend:** Node.js (NestJS) или Python (FastAPI).
- **Базы данных:** PostgreSQL, Redis.
- **Админ-панель:** Strapi или Directus.

## 6. Структура проектов

Проект технически состоит из трех взаимосвязанных, но отдельных компонентов:

1.  **Backend (Сервер/"Мозг"):** Хранит все данные и бизнес-логику. Предоставляет API для взаимодействия с другими частями системы.
2.  **Административная панель ("Пульт управления"):** Веб-интерфейс для контент-менеджеров, построенный на базе Headless CMS (Strapi/Directus). Использует API Backend'а для управления данными.
3.  **"АстроТочка" (Mini App/"Лицо"):** Клиентское веб-приложение на React для пользователей в Telegram. Также использует API Backend'а для получения контента и отправки действий пользователя.

## 7. План реализации и аналитика

-   **План MVP:** Фокус на реализации Профиля, Ленты, Экспертов, Поиска и базовой геймификации. **См. детальный план в [`backend_mvp_plan.md`](./backend_mvp_plan.md).**
-   **События аналитики:** `card_impression`, `detail_open`, `save`, `like`, `share`, `invite_success`, `stars_earn` и др.
-   **Ритм:** 10–15 T2, 5–10 T3, 3–5 A1, 5–7 K\*, 1–3 P\*, 2–3 V\*, 1 дайджест в неделю.